### ğŸ”¹ **åŸºç¡€ç¯‡ï¼ˆå¿…ç»ƒï¼‰** â€” å»ºç«‹ I/O æ„ŸçŸ¥

#### **ç»ƒä¹  1ï¼šåˆ›å»ºå¹¶å†™å…¥ä¸€ä¸ªæ–°æ–‡ä»¶**

> ä½¿ç”¨ `open()` æˆ– `creat()` åˆ›å»ºæ–‡ä»¶ `hello.txt`ï¼Œå†™å…¥ `"Hello, Unix!"`ã€‚

- ä½¿ç”¨ï¼š`open(O_CREAT | O_WRONLY | O_TRUNC)` æˆ– `creat()`
- ç”¨ `write()` å†™å…¥
- æœ€å `close()`



---

#### **ç»ƒä¹  2ï¼šè¯»å–æ–‡ä»¶å†…å®¹å¹¶è¾“å‡º**

> ä½¿ç”¨ `read()` è¯»å– `hello.txt` çš„å†…å®¹å¹¶é€šè¿‡ `write()` è¾“å‡ºåˆ°ç»ˆç«¯ã€‚

- ç”¨ `read()` + `write(STDOUT_FILENO, ...)`
    
- ç”¨ `sizeof(buffer)` æ§åˆ¶è¯»å–é•¿åº¦
    

---

#### **ç»ƒä¹  3ï¼šè¯»å–æ•´ä¸ªæ–‡ä»¶å†…å®¹ï¼ˆå¾ªç¯è¯»å–ï¼‰**

> å†™ä¸€ä¸ªç¨‹åºï¼Œæ¯æ¬¡è¯»å– 128 å­—èŠ‚ï¼Œç›´åˆ°æ–‡ä»¶ç»“æŸï¼Œå…¨éƒ¨è¾“å‡ºåˆ°å±å¹•ã€‚

- ç”¨ `while ((n = read(...)) > 0)` æ¨¡å¼
    

---

### ğŸ”¹ **è¿›é˜¶ç¯‡ï¼ˆæ“ä½œåç§» & æ–‡ä»¶æ§åˆ¶ï¼‰**

#### **ç»ƒä¹  4ï¼šç”¨ `lseek()` è·³è¿‡å‰10å­—èŠ‚å†è¯»**

> æ‰“å¼€ä»»æ„æ–‡ä»¶ï¼Œè·³è¿‡å‰10ä¸ªå­—èŠ‚ï¼Œä»ç¬¬11å­—èŠ‚å¼€å§‹è¯»å‡º10ä¸ªå­—èŠ‚ã€‚

- ç”¨ `lseek(fd, 10, SEEK_SET)`
    
- ç„¶å `read()` æ¥ç€è¯»å–
    

---

#### **ç»ƒä¹  5ï¼šè·å–æ–‡ä»¶å¤§å°**

> ä½¿ç”¨ `lseek()` å®šä½åˆ°æ–‡ä»¶æœ«å°¾ï¼Œè·å–æ–‡ä»¶æ€»é•¿åº¦å¹¶æ‰“å°ã€‚


`off_t size = lseek(fd, 0, SEEK_END);`

---

#### **ç»ƒä¹  6ï¼šä½¿ç”¨ `dup2()` é‡å®šå‘è¾“å‡º**

> å°† `STDOUT_FILENO` é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ `log.txt`ï¼Œç„¶åä½¿ç”¨ `printf()` æµ‹è¯•è¾“å‡ºæ˜¯å¦é‡å®šå‘æˆåŠŸã€‚

- ä½¿ç”¨ï¼š`dup2(fd, STDOUT_FILENO);`
    

---

### ğŸ”¹ **æƒé™ä¸åŒæ­¥ç¯‡**

#### **ç»ƒä¹  7ï¼šä½¿ç”¨ `umask()` è®¾ç½®é»˜è®¤æƒé™**

> ä½¿ç”¨ `umask(0)` å’Œ `umask(022)` åˆ†åˆ«åˆ›å»ºæ–‡ä»¶ï¼Œè§‚å¯Ÿæœ€ç»ˆæƒé™åŒºåˆ«ï¼ˆ`ls -l` æŸ¥çœ‹ï¼‰ã€‚

---

#### **ç»ƒä¹  8ï¼šå†™å…¥åä½¿ç”¨ `fsync()` å¼ºåˆ¶åˆ·æ–°**

> å‘æ–‡ä»¶å†™å…¥ä¸€æ®µæ–‡æœ¬åä½¿ç”¨ `fsync()`ï¼Œç¡®ä¿æ•°æ®å†™å…¥ç£ç›˜ã€‚

`write(fd, "data", 4); fsync(fd);`

---

### ğŸ”¹ **æŒ‘æˆ˜ç¯‡ï¼ˆç»„åˆä½¿ç”¨ï¼‰**

#### **ç»ƒä¹  9ï¼šæ–‡ä»¶å¤åˆ¶å°å·¥å…·ï¼ˆæ¨¡æ‹Ÿ cpï¼‰**

> å®ç°ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼š`mycp source.txt dest.txt`

- ç”¨ `open-read-write-close` ç»„åˆ
    
- æ¯æ¬¡è¯» 512 å­—èŠ‚
    
- æ£€æŸ¥é”™è¯¯å¤„ç†å’Œå…³é—­æ–‡ä»¶
    

---

#### **ç»ƒä¹  10ï¼šå†™å…¥ç¨€ç–æ–‡ä»¶ï¼ˆæ‰“æ´ï¼‰**

> ä½¿ç”¨ `lseek()` è·³è¿‡ 1GB å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œåˆ›å»ºä¸€ä¸ªâ€œç©ºæ´æ–‡ä»¶â€ã€‚

`int fd = open("sparse.dat", O_WRONLY | O_CREAT, 0644); lseek(fd, 1L << 30, SEEK_SET); write(fd, "X", 1);`

---

## ğŸ“¦ Bonus å¯é€‰ç»ƒä¹ ï¼ˆæ‰©å±•ç†è§£ï¼‰

|ç»ƒä¹ |å†…å®¹|
|---|---|
|ä½¿ç”¨ `isatty()` åˆ¤æ–­æ˜¯å¦æ˜¯ç»ˆç«¯||
|å†™å…¥ä¸€ä¸ª `int` æ•°ç»„ï¼ˆéå­—ç¬¦ä¸²ï¼‰åˆ°æ–‡ä»¶ï¼Œå†è¯»å–||
|å°†æ–‡ä»¶ä»æŸä¸ªåç§»å¼€å§‹å¤åˆ¶ä¸€æ®µå†…å®¹åˆ°å¦ä¸€ä¸ªæ–‡ä»¶||

---
